<div class="table-card p-4">
  <div class="flex flex-col items-center gap-4">

    <form [formGroup]="compareForm" class="flex flex-col md:flex-row gap-3 w-full justify-center" (ngSubmit)="compareEntities($event)">

      <!-- Entity 1 -->
      <p-dropdown
        formControlName="entity1"
        [options]="entityList"
        optionLabel="scripname"
        optionValue="entityid"
        [filter]="true"
        filterBy="scripname"
        [showClear]="true"
        placeholder="Select Entity 1"
        styleClass="w-64"
      >
        <ng-template let-entity pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ entity.scripname }}</div>
            <small class="text-color-secondary ml-2">({{ entity.scripcode }})</small>
          </div>
        </ng-template>
      </p-dropdown>

      <!-- Entity 2 -->
      <p-dropdown
        formControlName="entity2"
        [options]="filteredEntity2List"
        optionLabel="scripname"
        optionValue="entityid"
        [filter]="true"
        filterBy="scripname"
        [showClear]="true"
        placeholder="Select Entity 2"
        styleClass="w-64"
      >
        <ng-template let-entity pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ entity.scripname }}</div>
            <small class="text-color-secondary ml-2">({{ entity.scripcode }})</small>
          </div>
        </ng-template>
      </p-dropdown>

      <button
        pButton
        type="submit"
        label="Compare"
        icon="pi pi-chart-bar"
        [disabled]="compareForm.invalid"
      ></button>

    </form>

  </div>

      <!-- Comparison Result -->
  <div *ngIf="comparisonResult !== null" class="mt-4 p-4 w-full md:w-2/3 border rounded shadow-sm bg-gray-50">
  
  <!-- Header -->
  <div class=" p-4 text-center mb-6">
  <h3 class="text-xl font-bold text-900 mb-2">
    Comparison Result
  </h3>
  <p class="text-lg text-600">
    <span class="text-gray-600 font-semibold">{{ selectedEntity1?.scripName }}</span> 
    <span class="mx-2 text-500">vs</span> 
    <span class="text-gray-600 font-semibold">{{ selectedEntity2?.scripName }}</span>
  </p>
</div>


  <!-- Overlap Summary -->
 <div class="flex justify-content-around mb-3">
  <!-- Overlap Count -->
  <div class="py-3 px-8 bg-blue-50 border-round-xl shadow-1">
    <p class="text-600 text-sm">Overlap Count</p>
    <p class="text-lg font-bold text-blue-600">{{ comparisonResult.overlap?.count }}</p>
  </div>

  <!-- Overlap Weight -->
  <div class="py-3 px-8 bg-green-50 border-round-lg shadow-1">
    <p class="text-600 text-sm">Overlap Weight</p>
    <p class="text-lg font-bold text-green-600">{{ comparisonResult.overlap?.total_overlap_weight }}%</p>
  </div>

  <!-- Overlap % (Entity 1) -->
  <div class="py-3 px-8 bg-purple-50 border-round-lg shadow-1">
    <p class="text-600 text-sm">Overlap % ({{ selectedEntity1?.scripName }})</p>
    <p class="text-lg font-bold text-purple-600">{{ comparisonResult.overlap?.overlap_percentage_of_mf1 }}%</p>
  </div>
</div>


  <!-- Individual Fund Summary -->
 <div class="flex justify-content-around mb-3">
  <!-- Entity 1 -->
  <div class="p-3 border-round-lg  ">
    <h4 class="font-semibold text-blue-700 mb-2">{{ selectedEntity1?.scripName }}</h4>
    <p>
      Total Holdings:
      <span class="font-bold">
        {{ comparisonResult[selectedEntity1?.scripName]?.total_holdings }}
      </span>
    </p>
    <p>
      Total Weight:
      <span class="font-bold">
        {{ comparisonResult[selectedEntity1?.scripName]?.total_weight | number:'1.2-2' }}%
      </span>
    </p>
  </div>

  <!-- Entity 2 -->
  <div class="p-3 border-round-lg ">
    <h4 class="font-semibold text-blue-700 mb-2">{{ selectedEntity2?.scripName }}</h4>
    <p>
      Total Holdings:
      <span class="font-bold">
        {{ comparisonResult[selectedEntity2?.scripName]?.total_holdings }}
      </span>
    </p>
    <p>
      Total Weight:
      <span class="font-bold">
        {{ comparisonResult[selectedEntity2?.scripName]?.total_weight | number:'1.2-2' }}%
      </span>
    </p>
  </div>
</div>



  <!-- Overlap Details Table -->
 <div *ngIf="comparisonResult.overlap?.details?.length > 0">
  <h4 class="text-lg font-semibold mb-2 text-700">Overlap Details</h4>

  <div class="overflow-auto">
    <table class="w-full text-sm border-1 surface-border border-round-lg">
      <thead class="bg-gray-100 text-700">
        <tr>
          <th class="p-2 border-1 surface-border">ISIN</th>
          <th class="p-2 border-1 surface-border">{{ selectedEntity1?.scripName }} Weight</th>
          <th class="p-2 border-1 surface-border">{{ selectedEntity2?.scripName }} Weight</th>
          <th class="p-2 border-1 surface-border">Overlap %</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of comparisonResult.overlap.details" class="cursor-pointer">
          <td class="p-2 border-1 surface-border">{{ item.isin }}</td>
          <td class="p-2 border-1 surface-border text-center">{{ item.weight_mf1 | number:'1.2-2' }}%</td>
          <td class="p-2 border-1 surface-border text-center">{{ item.weight_mf2 | number:'1.2-2' }}%</td>
          <td class="p-2 border-1 surface-border text-center text-blue-600 font-semibold">
            {{ item.overlap_weight | number:'1.2-2' }}%
          </td>
        </tr>
      </tbody>

      <!-- Footer row for total overlap -->
      <tfoot *ngIf="comparisonResult.overlap?.total_overlap_weight !== undefined">
        <tr class="bg-gray-100 font-semibold">
          <td class="p-2 border-1 surface-border text-right" colspan="3">Total Overlap Weight:</td>
          <td class="p-2 border-1 surface-border text-center text-blue-700">
            {{ comparisonResult.overlap.total_overlap_weight | number:'1.2-2' }}%
          </td>
        </tr>
      </tfoot>

    </table>
  </div>
</div>



  <!-- No Overlap -->
 <div *ngIf="comparisonResult.overlap?.details?.length === 0" class="text-center text-500 italic">
  No overlapping holdings found.
</div>


</div>

</div>
