<h3>Welcome To The {{actionTableList[0].scrip_name}}</h3>

<div class="action-card">
  <div class="summary-header">
    <h4>Summary Of Actions <button pButton type="button" label="IRR = {{irrResult || 0}}%"  class="p-button-sm" style="transform: translateY(-15px); height: 25px; " ></button></h4>
    <div class="search-container">
      <span class="p-input-icon-left search-bar">
        <i class="pi pi-search"></i>
        <input 
          pInputText 
          type="text" 
          (input)="onGlobalFilter($event, 'action')" 
          placeholder="Search actions..." />
      </span>
    </div>
  </div>

  <!-- Action Table: Summary -->
  <p-table #actionTableSummary [value]="actionTableList" dataKey="id" [paginator]="true" [rows]="10"
    [rowsPerPageOptions]="[10,25,50]"
    [globalFilterFields]="['unit', 'order_date', 'order_type', 'purchase_amount','scrip_name']" 
    scrollHeight="700px" responsiveLayout="scroll">

    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="scrip_name">Scrip Name <p-sortIcon field="scrip_name"></p-sortIcon></th>
        <th pSortableColumn="unit">Units <p-sortIcon field="unit"></p-sortIcon></th>
        <th pSortableColumn="order_date">Order Date <p-sortIcon field="order_date"></p-sortIcon></th>
        <th pSortableColumn="order_type">Action <p-sortIcon field="order_type"></p-sortIcon></th>
        <th pSortableColumn="purchase_amount">Amount <p-sortIcon field="purchase_amount"></p-sortIcon></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.scrip_name }}</td>
        <td>{{ entity.unit | number:'1.2-2' }}</td>
        <td>{{ entity.order_date }}</td>
        <td>{{ entity.order_type }}</td>
        <td>{{ entity.purchase_amount | number:'1.2-2' }}</td>
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr>
        <td colspan="5">
          <div class="totals-row">
            <!-- Purchases -->
            <div class="totals-item">
              <strong>Purchases →</strong> 
              Units: {{ totalPurchaseUnits | number:'1.2-2' }} |
              Amount: {{ totalPurchaseAmount || 0 | currency:'INR' }}
            </div>

            <!-- Available -->
            <div class="totals-item available">
              <strong>Available →</strong> 
              Units: {{ availableUnits | number:'1.2-2' }} |
              Amount: {{ availableAmount || 0 | currency:'INR' }}
            </div>

            <!-- Sales -->
            <div class="totals-item" style="margin-right: 20px;">
              <strong>Sales →</strong> 
              Units: {{ totalSalesUnits | number:'1.2-2' }} |
              Amount: {{ totalSalesAmount || 0 | currency:'INR' }}
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

 
</div>



<!-- <h4>Transactions</h4>
<p-table #actionTableTransactions [value]="actionTableList" dataKey="id"
  [globalFilterFields]="['unit', 'order_date', 'order_type', 'purchase_amount','scrip_name']" scrollHeight="700px"
  styleClass="custom-table">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="scrip_name">Scrip Name <p-sortIcon field="scrip_name"></p-sortIcon></th>
      <th pSortableColumn="unit">Units <p-sortIcon field="unit"></p-sortIcon></th>
      <th pSortableColumn="order_date">Order Date <p-sortIcon field="order_date"></p-sortIcon></th>
      <th pSortableColumn="order_type">Action <p-sortIcon field="order_type"></p-sortIcon></th>
      <th pSortableColumn="purchase_amount">Amount <p-sortIcon field="purchase_amount"></p-sortIcon></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-entity>
    <tr>
      <td>{{ entity.scrip_name }}</td>
      <td>{{ entity.unit }}</td>
      <td>{{ entity.order_date }}</td>
      <td>{{ entity.order_type }}</td>
      <td>{{ entity.order_type === 'Purchase' ? '-' + entity.purchase_amount : '+' + entity.purchase_amount }}</td>
    </tr>
  </ng-template>
</p-table> -->

<!-- <div class="irr-card">
  <h3>Internal Rate of Return (IRR)</h3>
  <p>{{ irr | number:'1.2-2' }} %</p>
</div> -->

<div class="underlying-card">
  <div class="summary-header" style="margin-top: 30px;">
    <div class="title-block">
      <h4>Summary Of Underlying</h4>
      <h6 *ngIf="underlyingTableList?.length" class="underlying-date">
        The underlying table is as of 
        <span class="date-value">{{ underlyingTableList[0]?.created_at | date:'dd MMM yyyy' }}</span>
      </h6>
    </div>

    <div class="search-container">
      <span class="p-input-icon-left search-bar">
        <i class="pi pi-search"></i>
        <input pInputText type="text" (input)="onGlobalFilter($event, 'underlying')" placeholder="Search underlying..." />
      </span>
    </div>
  </div>

  <p-table #underlyingTable [value]="underlyingTableList" dataKey="id" [paginator]="true" [rows]="10"
    [rowsPerPageOptions]="[10,25,50]" [globalFilterFields]="['scripcode', 'weightage', 'isin_code','company_name']"
    scrollHeight="700px" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="company_name">Company Name <p-sortIcon field="company_name"></p-sortIcon></th>
        <th pSortableColumn="scripcode">Scrip Code <p-sortIcon field="scripcode"></p-sortIcon></th>
        <th pSortableColumn="weightage">Weightage <p-sortIcon field="weightage"></p-sortIcon></th>
        <th pSortableColumn="sector">Sector <p-sortIcon field="sector"></p-sortIcon></th>
        <th pSortableColumn="isin_code">ISIN <p-sortIcon field="isin_code"></p-sortIcon></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.company_name }}</td>
        <td>{{ entity.scripcode }}</td>
        <td>{{ entity.weightage }} %</td>
        <td>{{ entity.sector }}</td>
        <td>{{ entity.isin_code }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>


<!-- Pie Chart Card -->
<div class="counts-card"  style="margin-bottom: 2rem;">
  <p-card header="MCAP Tag Allocation" styleClass="P-card">
    <div class="card-content">
      
      <div class="counts-section">
        <div>
          <h4>Total Companies : {{underlyingTableList?.length}}</h4>
        </div>
        <div class="count-item">
          <span class="dot lcap"></span>
          <span class="label">Large Cap</span>
          <span class="percent">{{ actionCounts?.lcap_percent | number:'1.0-1' }}%</span>
        </div>
        <div class="count-item">
          <span class="dot mcap"></span>
          <span class="label">Mid Cap</span>
          <span class="percent">{{ actionCounts?.mcap_percent | number:'1.0-1' }}%</span>
        </div>
        <div class="count-item">
          <span class="dot scap"></span>
          <span class="label">Small Cap</span>
          <span class="percent">{{ actionCounts?.scap_percent | number:'1.0-1' }}%</span>
        </div>
      </div>

      <div class="chart-section">
        <p-chart type="pie" [data]="chartData" [options]="chartOptions"></p-chart>
      </div>
    </div>
  </p-card>
</div>
