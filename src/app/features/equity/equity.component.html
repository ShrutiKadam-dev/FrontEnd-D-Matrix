<!-- Search Section -->
<div class="search-section" style="margin-left: 70px;">
  <p-autoComplete [(ngModel)]="selectedEquityName" [suggestions]="filteredENames" (completeMethod)="searchEquity($event)"
    (onSelect)="scrollToDE($event)" field="subcategory" placeholder="Search Equity.." [minLength]="1">
  </p-autoComplete>

  <button *ngIf="selectedEquityName" pButton icon="pi pi-times" class="p-button-text" (click)="clearSearch()">
  </button>
</div>

<!-- Carousel -->
<p-carousel [value]="displayEs" [numVisible]="3" [numScroll]="3" [circular]="false"
  [responsiveOptions]="responsiveOptions" *ngIf="!selectedEquityName">

  <ng-template let-e pTemplate="item">
    <p-card styleClass="P-card" (click)="goToEquityDetails(e)" [ngStyle]="{ cursor: 'pointer' }">
      <ng-template pTemplate="header">
        <div class="card-color" [ngStyle]="{'background-color': e.color}"></div>
      </ng-template>
      <!-- Truncate with ellipsis & tooltip -->
      <div class="card-title" [pTooltip]="e.subcategory">{{ e.subcategory || 'No Subcategory' }}</div>
      <div class="card-value">{{ e.category || 'No Category' }}</div>
      <div class="status">Total Entity Count : {{ e.total }}</div>
    </p-card>
  </ng-template>
</p-carousel>

<!-- Search Result Card -->
<p-carousel *ngIf="selectedEquityName" [value]="filteredENames" [numVisible]="3" [numScroll]="3" [circular]="false"
  [responsiveOptions]="responsiveOptions" styleClass="custom-carousel">
  
  <ng-template let-e pTemplate="item">
    <p-card styleClass="P-card" [ngStyle]="{ cursor: 'pointer'}" (click)="goToEquityDetails(e)">
      <ng-template pTemplate="header">
        <div class="card-color" [ngStyle]="{'background-color': e.color}"></div>
      </ng-template>
      <!-- Truncate with ellipsis & tooltip -->
      <div class="card-title" [pTooltip]="e.subcategory">{{ e.subcategory || 'No Subcategory' }}</div>
      <div class="card-value">{{ e.category || 'No Category' }}</div>
      <div class="status">Total Entity Count : {{ e.total }}</div>
    </p-card>
  </ng-template>
</p-carousel>

<!-- MCAP Chart -->
<div class="counts-card" style="margin-bottom: 2rem;">
  <p-card styleClass="P-card">
    <h4>Equity Tag Allocation</h4>
    <div class="card-content">
      <div class="counts-section">
        <div>
          <h4>Total Number of Underlying : {{ actionCounts?.total_count }}</h4>
        </div>
        <div *ngFor="let tag of underlyingTableList">
          <div class="count-item">
            <span class="dot" [ngStyle]="{'background-color': tag.color || '#42A5F5'}"></span>
            <span class="label">{{ tag.tag }}</span>
            <span class="percent">{{ tag.overall_tag_percent | number:'2.2' }}%</span>
          </div>
        </div>
      </div>
      <div class="chart-section">
        <p-chart *ngIf="mcapChartData" type="pie" [data]="mcapChartData" [options]="mcapChartOptions"></p-chart>
      </div>
    </div>
  </p-card>
</div>

<div class="table-card" style="margin-top: 2rem;">
  <h3>Summary Of Actions</h3>

  <h4>Mutual Fund Action Table</h4>
  <p-table [value]="MFActionTableList" [paginator]="true" [rows]="10"
    [rowsPerPageOptions]="[5, 10, 25, 100, 500, 1000]">
    <ng-template pTemplate="header">
      <tr>
        <th>Scrip Name</th>
        <th>Order Type</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.scrip_name }}</td>
        <td><p-tag [value]="entity.order_type" [severity]="getSeverity(entity.order_type)" /></td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="2">No Records found</td>
      </tr>
    </ng-template>
  </p-table>

  <h4>AIF Action Table</h4>
  <p-table [value]="aifTableList" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 25, 100, 500, 1000]">
    <ng-template pTemplate="header">
      <tr>
        <th>AMC Name</th>
        <th>Contribution Amount</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.amc_name }}</td>
        <td>{{ entity.contribution_amount | number:'1.2-2' }}</td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="2">No Records found</td>
      </tr>
    </ng-template>
  </p-table>

  <h4>Direct Equity Action Table</h4>
  <p-table [value]="directEquityTableList" [paginator]="true" [rows]="10"
    [rowsPerPageOptions]="[5, 10, 25, 100, 500, 1000]">
    <ng-template pTemplate="header">
      <tr>
        <th>Order Type</th>
        <th>Trade Price</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.order_type }}</td>
        <td>{{ entity.trade_price | number:'1.2-2' }}</td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="2">No Records found</td>
      </tr>
    </ng-template>
  </p-table>
</div>