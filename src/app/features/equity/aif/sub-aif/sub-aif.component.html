<h3>Welcome To The {{contractNote[0]?.amc_name || "AIF"}}</h3>
<!-- summary of action -->

<div class="table-card">
  <!-- Header -->
  <div class="search-header p-d-flex p-ai-center p-jc-between">
    <h4>Summary Of Actions <button pButton type="button" label="IRR = {{ irrResult || 0 }}%" class="p-button-sm ml-2"
        style="height: 28px;"></button>
    </h4>
    <div class="search-container">
      <input pInputText type="text" (input)="onGlobalFilter($event, 'action')" placeholder="Search actions..." />
    </div>
  </div>
  <!-- Action Table -->
  <p-table #actionTableSummary [value]="contractNote" dataKey="id" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 25, 100, 500, 1000]"
    [globalFilterFields]="['amc_name', 'num_units', 'trans_date', 'trans_type', 'contribution_amount']"
    scrollHeight="400px" [responsiveLayout]="'scroll'">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="amc_name">Scrip Name <p-sortIcon field="amc_name"></p-sortIcon></th>
        <th pSortableColumn="num_units">Units <p-sortIcon field="num_units"></p-sortIcon></th>
        <th pSortableColumn="trans_date">Order Date <p-sortIcon field="trans_date"></p-sortIcon></th>
        <th pSortableColumn="trans_type">Action <p-sortIcon field="trans_type"></p-sortIcon></th>
        <th pSortableColumn="contribution_amount">Contribution Amount <p-sortIcon
            field="contribution_amount"></p-sortIcon></th>
        <th pSortableColumn="stamp_duty">Stamp Duty <p-sortIcon field="stamp_duty"></p-sortIcon></th>
        <th pSortableColumn="amount_invested">Amount Invested <p-sortIcon field="amount_invested"></p-sortIcon></th>
        <th pSortableColumn="balance_units">Balance Units <p-sortIcon field="balance_units"></p-sortIcon></th>
        <th pSortableColumn="post_tax_nav">Post Tax Nav <p-sortIcon field="post_tax_nav"></p-sortIcon></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.amc_name }}</td>
        <td>{{ entity.num_units }}</td>
        <td>{{ entity.trans_date }}</td>
        <td>{{ entity.trans_type }}</td>
        <td>{{ entity.contribution_amount }}</td>
        <td>{{ entity.stamp_duty }}</td>
        <td>{{ entity.amount_invested }}</td>
        <td>{{ entity.balance_units }}</td>
        <td>{{ entity.post_tax_nav }}</td>
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr class="summary-row">
        <td colspan="3" class="summary green">
          Purchases → Units: {{ totalPurchaseUnits | number:'1.2-2' }} |
          Amount: {{ totalPurchaseAmount | currency:'INR' }}
        </td>
        <td colspan="3" class="summary blue">
          Available → Units: {{ availableUnits | number:'1.2-2' }} |
          Amount: {{ availableAmount | currency:'INR' }}
        </td>
        <td colspan="3" class="summary red text-right">
          Sales → Units: {{ totalSalesUnits | number:'1.2-2' }} |
          Amount: {{ totalSalesAmount | currency:'INR' }}
        </td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="9">No Records found</td>
      </tr>
    </ng-template>

  </p-table>
</div>

<div class="table-card">
  <!-- Header -->
  <h4>Summary Of Underlying</h4>
  <div class="search-header p-d-flex p-ai-center p-jc-between">

    <div class="underlying-date">
      Last Updated At
      <span class="date-badge">
        {{ underlyingList[0]?.created_at | date:'dd MMM yyyy' }}
      </span>
    </div>

    <div class="search-container">
      <input pInputText type="text" (input)="onGlobalFilter($event, 'underlying')" placeholder="Search underlying..." />
    </div>
  </div>

  <!-- Underlying Table -->
  <p-table #underlyingTable [value]="underlyingList" dataKey="id" [paginator]="true" [rows]="10"
    [rowsPerPageOptions]="[10, 25, 100, 500, 1000]" [globalFilterFields]="['company_name','scripcode', 'weightage', 'sector']"
    scrollHeight="400px" [responsiveLayout]="'scroll'">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="company_name">Company Name <p-sortIcon field="company_name"></p-sortIcon></th>
        <th pSortableColumn="scripcode">Scrip Code <p-sortIcon field="scripcode"></p-sortIcon></th>
        <th pSortableColumn="weightage">Weightage <p-sortIcon field="weightage"></p-sortIcon></th>
        <th pSortableColumn="sector">Sector <p-sortIcon field="sector"></p-sortIcon></th>
         <th pSortableColumn="tag">Tag <p-sortIcon field="tag"></p-sortIcon></th>
        <th pSortableColumn="isin_code">ISIN <p-sortIcon field="isin_code"></p-sortIcon></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.company_name }}</td>
        <td>{{ entity.scripcode }}</td>
        <td>{{ entity.weightage }}</td>
        <td>{{ entity.sector }}</td>
        <td>{{ entity.tag }}</td>
        <td>{{ entity.isin_code }}</td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="5">No Records found</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- MCAP Tag Allocation -->
<div class="counts-card" style="margin-bottom: 2rem;">
  <p-card styleClass="P-card">
    <h4>MCAP Tag Allocation</h4>
    <div class="card-content">
      <div class="counts-section">
        <div>
          <h4>Total Number of Underlying : {{ actionCounts?.total_count }}</h4>
        </div>
        <div *ngFor="let tag of mcapTableList">
          <div class="count-item">
            <span class="dot" [ngStyle]="{'background-color': tag.color || '#42A5F5'}"></span>
            <span class="label">{{ tag.tag }}</span>
            <span class="percent">{{ tag.tag_percent | number:'1.0-1' }}%</span>
          </div>
        </div>
      </div>
      <div class="chart-section">
        <p-chart *ngIf="mcapChartData" type="pie" [data]="mcapChartData" [options]="mcapChartOptions"></p-chart>
      </div>
    </div>
  </p-card>
</div>

<!-- Sector Allocation -->
<div class="counts-card" style="margin-bottom: 2rem;">
  <p-card styleClass="P-card">
    <h4>Sector Allocation</h4>
    <div class="card-content">
      <div class="counts-section">
        <div>
          <h4>Total Number of Underlying : {{ sectorCounts?.total_count }}</h4>
        </div>
        <div *ngFor="let sector of sectorTableList">
          <div class="count-item">
            <span class="dot" [ngStyle]="{'background-color': sector.color || '#42A5F5'}"></span>
            <span class="label">{{ sector.sector }}</span>
            <span class="percent">{{ sector.sector_percent | number:'1.0-1' }}%</span>
          </div>
        </div>
      </div>
      <div class="chart-section">
        <p-chart *ngIf="sectorChartData" type="pie" [data]="sectorChartData" [options]="sectorChartOptions"></p-chart>
      </div>
    </div>
  </p-card>
</div>