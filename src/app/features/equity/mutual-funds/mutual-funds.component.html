<div class="first-div">
  <button class="back-btn" (click)="goBack()">
  <i class="pi pi-arrow-left"></i>
</button>
<h3>Welcome To The Master Mutual Fund</h3>
</div>
<!-- Search Section -->
<div class="search-section" style="margin-left: 70px;">
  <p-autoComplete [(ngModel)]="selectedMfName"
                  [suggestions]="filteredMfNames"
                  (completeMethod)="searchMfs($event)"
                  (onSelect)="scrollToMf($event)"
                  field="nickname"
                  placeholder="Search MF..."
                  [minLength]="1">
  </p-autoComplete>

  <button *ngIf="selectedMfName" pButton icon="pi pi-times" class="p-button-text" (click)="clearSearch()"></button>
</div>

<!-- Carousel -->
<p-carousel [value]="displayMfs" [numVisible]="3" [numScroll]="3" [circular]="false" [responsiveOptions]="responsiveOptions" *ngIf="!selectedMfName">
  <ng-template let-mf pTemplate="item">
    <p-card styleClass="P-card" (click)="goToMfDetails(mf)" [ngStyle]="{ cursor: 'pointer' }">
      <ng-template pTemplate="header">
        <div class="card-color" [ngStyle]="{'background-color': mf.color}"></div>
      </ng-template>
      <div class="card-title" [pTooltip]="mf.nickname">{{ mf.nickname || 'No Name' }}</div>
      <div class="card-value">{{ mf.subcategory || 'No Subcategory' }}</div>
      <div class="status">{{ mf.entityid }}</div>
    </p-card>
  </ng-template>
</p-carousel>

<!-- MCAP Chart -->
<div class="counts-card" style="margin-bottom: 2rem;">
  <p-card styleClass="P-card">
    <h4>MCAP Tag Allocation</h4>
    <div class="card-content">
      <div class="counts-section">
        <div >
          <h4>Total Number of Underlying : {{ actionCounts?.total_count }}</h4>
        </div>
        <div *ngFor="let tag of underlyingTableList">
          <div class="count-item">
            <span class="dot" [ngStyle]="{'background-color': tag.color || '#42A5F5'}"></span>
            <span class="label">{{ tag.tag }}</span>
            <span class="percent">{{ tag.tag_percent | number:'1.0-1' }}%</span>
          </div>
      </div>
      </div>
      <div class="chart-section">
        <p-chart *ngIf="mcapChartData" type="pie" [data]="mcapChartData" [options]="mcapChartOptions"></p-chart>
      </div>
    </div>
  </p-card>
</div>

<!-- Table Section -->
<div class="table-card">
  <div class="search-header p-d-flex p-ai-center p-jc-between">
    <h3>Summary Of Actions
      <button pButton type="button" label="IRR = {{ irrResult || 0 }}%" class="p-button-sm ml-2" style="height: 28px;"></button>
    </h3>
    <div class="search-container">
      <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Search entities..." />
    </div>
  </div>

  <p-table #dt [value]="actionTableList" dataKey="id" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 25, 100, 500, 1000]"
           [globalFilterFields]="['unit', 'order_date', 'order_type', 'purchase_amount','scrip_name']" scrollHeight="700px">
    <ng-template pTemplate="header" [resizableColumns]="true" columnResizeMode="expand">
      <tr>
        <th>Scrip Name</th>
        <th>Units</th>
        <th>Order Date</th>
        <th>Action</th>
        <th>Amount</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-entity>
      <tr>
        <td>{{ entity.scrip_name }}</td>
        <td>{{ entity.unit }}</td>
        <td>{{ entity.order_date }}</td>
        <td><p-tag [value]="entity.order_type" [severity]="getSeverity(entity.order_type)"></p-tag></td>
        <td>{{ entity.purchase_amount | number:'1.2-2'}}</td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr><td colspan="5">No Records found</td></tr>
    </ng-template>
  </p-table>
</div>

<!-- Sector Chart -->
<div class="counts-card" style="margin-bottom: 2rem;">
  <p-card styleClass="P-card">
    <h4>Sector Allocation</h4>
    <div class="card-content">
      <div class="counts-section">
        <div>
          <h4>Total Number of Underlying : {{ sectorCounts?.total_count }}</h4>
        </div>
        <div *ngFor="let s of sectorTableList" class="count-item">
          <span class="dot" [ngStyle]="{'background-color': s.color}"></span>
          <span class="label">{{ s.sector }}</span>
          <span class="percent">{{ s.sector_percent | number:'1.0-1' }}%</span>
        </div>
      </div>
      <div class="chart-section">
        <p-chart *ngIf="sectorChartData" type="pie" [data]="sectorChartData" [options]="sectorChartOptions"></p-chart>
      </div>
    </div>
  </p-card>
</div>
