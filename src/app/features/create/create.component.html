<!-- Add Entity Button -->
<p-button label="Create Entity" icon="pi pi-plus" (click)="showModal()" styleClass="add-entity-btn">
</p-button>

<!-- Search Box Below Add Entity -->
<div class="search-container half-width">
  <span class="p-input-icon-left search-bar">
    <i class="pi pi-search"></i>
    <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Search..." />
  </span>
</div>

<!-- Add/Update Entity Dialog -->
<p-dialog [header]="isEditMode ? 'Edit Entity' : 'Add New Entity'" [(visible)]="displayModal" [modal]="true"
  [closable]="true" [style]="{ width: '35vw', 'max-height': '90vh' }" [contentStyle]="{ 'overflow-y': 'auto' }">

  <form [formGroup]="entityForm" class="p-fluid">
    <div class="field">
      <label for="scripname">Scrip Name</label>
      <input id="scripname" pInputText formControlName="scripname" placeholder="Enter Scrip Name">
    </div>

    <div class="field">
      <label for="scripcode">Scrip Code</label>
      <input id="scripcode" pInputText formControlName="scripcode" placeholder="Enter Scrip Code">
    </div>

    <div class="field">
      <label for="nickname">Nick Name</label>
      <input id="nickname" pInputText formControlName="nickname" placeholder="Enter Nickname">
    </div>

    <div class="field">
      <label for="category">Category</label>
      <p-dropdown id="category" formControlName="category" [options]="categoryOptions" placeholder="Select Category"
        appendTo="body">
      </p-dropdown>
    </div>

    <div class="field">
      <label for="subcategory">Sub Category</label>
      <p-dropdown id="subcategory" formControlName="subcategory" [options]="subCategoryOptions"
        placeholder="Select Sub Category" appendTo="body" panelStyleClass="subcategory-panel" dropdownPosition="top">
      </p-dropdown>
    </div>

    <div class="field">
      <label for="benchmark">Benchmark</label>
      <input id="benchmark" pInputText formControlName="benchmark" placeholder="Enter Benchmark">
    </div>

    <div class="dialog-actions">
      <p-button label="Cancel" icon="pi pi-times" styleClass="add-entity-btn" (click)="displayModal = false">
      </p-button>

      <p-button [label]="isEditMode ? 'Update' : 'Add'" icon="pi pi-check" styleClass="add-entity-btn"
        (click)="isEditMode ? saveUpdatedEntity() : addEntity()" [disabled]="entityForm.invalid">
      </p-button>
    </div>
  </form>
</p-dialog>

<!-- Entity Table -->
<p-table #dt [value]="entityList" dataKey="id" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5,10,25, 50]"
  [globalFilterFields]="['scripname', 'scripcode', 'nickname', 'category', 'subcategory', 'benchmark']">
  <ng-template pTemplate="header">
    <tr>
      <th>Scrip Name</th>
      <th>Scrip Code</th>
      <th>Benchmark</th>
      <th>Action</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-entity>
    <tr>
      <td>{{ entity.scripname }}</td>
      <td>{{ entity.scripcode }}</td>
      <td>{{ entity.benchmark }}</td>
      <td>
        <p-button label="Edit" icon="pi pi-pencil" styleClass="p-button-sm p-button-warning action-btn"
          (click)="editEntity(entity)">
        </p-button>
        <p-button label="Update" icon="pi pi-pencil" styleClass="p-button-sm p-button-warning action-btn"
          (click)="updateEntity(entity)">
        </p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Edit Choice Dialog -->
<!-- Update Choice Dialog -->
<p-dialog header="Update Table" [(visible)]="displayUpdateChoiceModal" [modal]="true" [closable]="true"
  [style]="{ width: '25vw' }">
  <div class="p-fluid">
    <p>Which table would you like to update?</p>
    <div class="edit-choice-buttons">
      <p-button label="Contract Note" icon="pi pi-table" class="mb-2" (click)="updateActionTable(selectedEntity)"></p-button>
      <p-button label="Underlying" icon="pi pi-list" class="mb-2" (click)="updateUnderlyingTable(selectedEntity)"></p-button>
    </div>

  </div>
</p-dialog>

<!-- Add Underlying Table Dialog -->
<p-dialog header="Add Underlying Data" [(visible)]="displayUnderlyingModal" [modal]="true" [closable]="true"
  [style]="{ width: '30vw' }" [contentStyle]="{ 'overflow-y': 'auto' }">

  <form [formGroup]="underlyingForm" class="p-fluid">
    <div class="field">
      <label for="company_name">Company Name</label>
      <input id="company_name" pInputText formControlName="company_name" placeholder="Enter Company Name">
    </div>

    <div class="field">
      <label for="scripcode">Scrip Code</label>
      <input id="scripcode" pInputText formControlName="scripcode" placeholder="Enter Scrip Code">
    </div>

    <div class="field">
      <label for="weightage">Weightage (%)</label>
      <input id="weightage" type="number" pInputText formControlName="weightage" placeholder="Enter Weightage">
    </div>

    <div class="field">
      <label for="sector">Sector</label>
      <input id="sector" pInputText formControlName="sector" placeholder="Enter Sector">
    </div>

    <div class="field">
      <label for="isin_code">ISIN Code</label>
      <input id="isin_code" pInputText formControlName="isin_code" placeholder="Enter ISIN Code">
    </div>

    <div class="dialog-actions flex justify-content-end gap-2 mt-3">
      <p-button label="Cancel" icon="pi pi-times" styleClass="add-entity-btn"
        (click)="displayUnderlyingModal = false"></p-button>
      <p-button label="Save" icon="pi pi-check" [disabled]="underlyingForm.invalid" styleClass="add-entity-btn"
        (click)="saveUnderlyingData()"></p-button>
    </div>
  </form>
</p-dialog>

<!-- Add Action Table Dialog -->
<p-dialog header="Add Action Table Data" [(visible)]="displayActionTableModal" [modal]="true" [closable]="true"
  [style]="{ width: '40vw' }" [contentStyle]="{ 'overflow-y': 'auto' }">

  <form [formGroup]="actionTableForm" class="p-fluid">
    <div class="field" *ngFor="let field of actionTableFields">
      <label [for]="field.key">{{ field.label }}</label>
      <input [id]="field.key" pInputText [formControlName]="field.key" [placeholder]="'Enter ' + field.label">
    </div>

    <div class="dialog-actions flex justify-content-end gap-2 mt-3">
      <p-button label="Cancel" icon="pi pi-times" styleClass="add-entity-btn"
        (click)="displayActionTableModal = false"></p-button>
      <p-button label="Save" icon="pi pi-check" [disabled]="actionTableForm.invalid" styleClass="add-entity-btn"
        (click)="saveActionTableData()"></p-button>
    </div>
  </form>
</p-dialog>
